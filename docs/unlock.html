<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Puma Unlock Demo</title>

  <script>
    /*
    all test locks
    "locks": {        
        "0x7f389Df70E090849ec32869E28fc33DC522108f7": {
          "name": "Puma lock priced in ETH. Free"
        },
        "0xE13d43323746c7fBC5994c59b9FC7B992a72d7c4": {
          "name": "Puma lock priced in PC (Puma Coin). Free"
        },
        "0x2B0ed09862Bb5BbC43DfcE2D29629a34EdC2B664":{
          "name": "Puma lock priced in ETH. Cost 0.0001"
        },
        "0x63A2AA0e9ff0dF21E362c7D6E79A2218767C1EDE":{
          "name": "Second Puma lock priced in ETH. Cost 0.0001"
        },
        "0x54705167F67A4960200b2Fb8d99ae576D83E8b22":{
          "name": "Third Puma lock priced in ETH. Cost 0.0001"
        },
        "0xccf20531fe0D10740e9de0f11CC57D91F833e6dE":{
          "name": "Fourth Puma lock priced in ETH. Cost 0.0001"
        },
        "0xC3C6B54D2DC61ab7deBDe18799E5C8cb5db130c6":{
          "name": "Fifth Puma lock priced in ETH. Cost 0.0001"
        },
        "0x5e5153A3A70b4917175501863f8d379092F17406":{
          "name": "Lock in PT (Puma Token), cost 0.01 PT"
        }
      },
      "metadataInputs": [ 
        { "name": "Text field", "type":"text", "required": true, "defaultValue":"test", "public": false  },
        { "name": "Date field", "type":"date", "required": false, "defaultValue":"01/01/2020", "public": true  },
        { "name": "Color field", "type":"color", "required": false, "defaultValue":"#a6a6a6", "public": false  },
        { "name": "Email field", "type":"email", "required": true, "defaultValue":"test", "public": false  },
        { "name": "URL field", "type":"url", "required": true, "defaultValue":"test", "public": false  }
      ]
    */


    window.unlockProtocolConfig = {    
      "pessimistic": true,    
      "network": 4,           
      "locks": {        
        "0x5e5153A3A70b4917175501863f8d379092F17406":{
          "name": "Lock in PT (Puma Token), cost 0.01 PT"
        }
      },
      "icon": "https://test.puma.tech/puma_round_200.png",    
      "callToAction": {        
        "default": "Get the key on Rinkeby",
        "expired": "The lock has expired. Please renew",
        "metadata": "Please fill in the following:"   
      },
      "metadataInputs": [ 
        { "name": "Text field", "type":"text", "required": true, "defaultValue":"test", "public": false  },
        { "name": "Date field", "type":"date", "required": false, "defaultValue":"01/01/2020", "public": true  },
        { "name": "Color field", "type":"color", "required": false, "defaultValue":"#a6a6a6", "public": false  },
        { "name": "Email field", "type":"email", "required": true, "defaultValue":"test", "public": false  },
        { "name": "URL field", "type":"url", "required": true, "defaultValue":"test", "public": false  }
      ]

    }

    function logEvent(event){
      logTo(container, event)

      var locks = event.detail.locks

      if ( !locks ){
        locks = Object.keys(window.unlockProtocolConfig.locks)
      }
      
      locks.forEach(function(lock){
      	var container = document.getElementById(lock.substr(15) + "container")
        logTo(container, event)
        if (event.detail.state == "unlocked"){
        	document.getElementById(lock.substr(15) + "locked").style.display = "none"
          document.getElementById(lock.substr(15) + "unlocked").style.display = "block"
        }else{
          document.getElementById(lock.substr(15) + "locked").style.display = "block"
          document.getElementById(lock.substr(15) + "unlocked").style.display = "none"
        }
        
        
      })
    }

    function logTo(container, e){
      container.innerText = container.innerText + 
        "Event type:" + JSON.stringify(e.type, null, 2) + '\n' +
        "Event details" + JSON.stringify(e.detail, null, 2) + '\n\n';
      console.log(e);
    }
    
    function logString(container, s){
      container.innerText = container.innerText + 
        "String:" + s + '\n\n';
      console.log(s);
    }

    window.addEventListener('unlockProtocol.status', logEvent)
    window.addEventListener('unlockProtocol.authenticated', logEvent)
    window.addEventListener('unlockProtocol.transactionSent', logEvent)
  </script>

  <script>
    function addLocks(){
      locks = window.unlockProtocolConfig.locks
      console.log(JSON.stringify(locks))
      for ( let [lockAddress,lockData] of Object.entries(locks) ) {
      	var div = document.createElement('div')
        var line1 = document.createElement('p')
        line1.innerHTML = "<h3>" + lockData.name + "</h3>"
        
        
        var line2 = document.createElement('p')
        line2.id = lockAddress.substr(15) + "locked"
        line2.innerHTML = lockData.name + " is locked ðŸ”’"
        line2.style.display = "block"
        
        var line3 = document.createElement('p')
        line3.id = lockAddress.substr(15) + "unlocked"
        line3.innerHTML = lockData.name + " is unlocked ðŸŽ‰"
        line3.style.display = "none"
        
        var line4 = document.createElement('pre')
        line4.id = lockAddress.substr(15) + "container"
        line4.classList.add("container")
        
        div.appendChild(line1)
        div.appendChild(line2)
        div.appendChild(line3)
        div.appendChild(line4)
        
		    document.body.appendChild(div)
      }
      
      var div = document.createElement('div')
      div.innerHTML = 
        "<p id='buy_button' onclick='window.unlockProtocol && window.unlockProtocol.loadCheckoutModal()''><button class='button'>" + 
        "Unlock!" +
        "</button></p>" +
        "<h3>All events</h3> " +
        "<pre id='container' class='container'>" +
        "</pre>"
	    document.body.appendChild(div)
    }
  
  </script>

  <style>
    body{
      font-family:sans-serif;
    }

    pre.container{
      background-color:lightgreen;
      padding:10px;
    }

    .error{
      display:none;
      background-color:pink;
      padding:10px;
    }
  </style>

</head>

<body onload="addLocks()">

<script src="https://paywall.unlock-protocol.com/static/unlock.latest.min.js" async=""></script>
<h1>Simple Unlock Demo</h1>


</html>
